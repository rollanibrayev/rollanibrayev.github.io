<html>
  <head>
    <title>True 720p</title>
    <link rel="stylesheet" href="styles.css">
    <script src="script.js" defer></script>
    <style>
      body {
        margin: 0;
        overflow: hidden
      }
      #channelForm {
        text-align: center
      }
      #iframeContainer {
        position: fixed
      }
    </style>
  </head>
  <body>
    <form id="channelForm">
      <div>Channel Link or Name:</div>
      <label for="channel1"></label>
      <input type="text" id="channel1" name="channel1" required><br>

      <label>Player Position:</label>
      <div style='/*float: right*/'>
        <input type="radio" id="top_left" name="position" value="top: 0; left: 0">
        <label for="top_left">Top Left</label>

        <input type="radio" id="top_right" name="position" value="top: 0; right: 0">
        <label for="top_right">Top Right</label><br>

        <input type="radio" id="bottom_left" name="position" value="bottom: 0; left: 0">
        <label for="bottom_left">Bottom Left</label>

        <input type="radio" id="bottom_right" name="position" value="bottom: 0; right: 0" checked>
        <label for="bottom_right">Bottom Right</label><br>
      </div>

      <input type="button" value="Start Watching" onclick="generateIframes()">
    </form>
    <div id="iframeContainer"></div>
    <script>
      // Variable to store previous channel names and quality
      let prevChannels = {};

      const generateIframes = function() {
        let channel1 = extractChannelName(document.getElementById("channel1").value.trim());

        if (channel1) {
          createIframe("frame1", channel1);

          document.getElementById("channelForm").style.display = "none";
        } else {
          alert("Please enter at least one channel name.");
        }
      }

      const extractChannelName = function(fullText) {
        // If the text contains '/', extract the text after the last '/'
        let lastSlashIndex = fullText.lastIndexOf('/');
        return (lastSlashIndex !== -1) ? fullText.substring(lastSlashIndex + 1) : fullText;
      }

      const createIframe = function(id, channel) {
        let iframeContainer = document.getElementById("iframeContainer");
        let position = document.querySelector('input[name="position"]:checked').value;

        if (channel !== "" && (prevChannels[id] !== channel || prevQuality !== quality)) {
          let iframe = document.createElement("iframe");
          iframe.id = id;
          iframe.name = id;
          iframe.src = `https://player.twitch.tv/?channel=${channel}&enableExtensions=true&muted=false&parent=rollanibrayev.github.io&player=popout&quality=720p60&volume=1`;
          iframe.frameborder=0;
          iframe.allowfullscreen=true;
          //iframe.scrolling=no;
          iframe.height=720;
          iframe.width=1280;
          iframe.style = `border: 0`;

          iframeContainer.style = position;
          iframeContainer.appendChild(iframe);

          prevChannels[id] = channel;
        }
      }
    </script>
  </body>
</html>
